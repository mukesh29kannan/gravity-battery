<!DOCTYPE html>
<html>
<head>
  <title>ESP32 Sensor Dashboard</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    .card { border: 1px solid #ccc; padding: 10px; margin: 10px 0; }
    label { display: block; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>ESP32 Sensor Dashboard</h1>

  <div class="card">
    <p><strong>Temperature:</strong> <span id="temp">--</span> Â°C</p>
    <p><strong>Humidity:</strong> <span id="humidity">--</span> %</p>
    <p><strong>Current:</strong> <span id="current">--</span> A</p>
    <p><strong>Relay Status:</strong> <span id="relay">OFF</span></p>
  </div>

  <div class="card">
    <label>
      Max Temperature:
      <input type="number" id="maxTemp" />
    </label>

    <label>
      Timer (sec):
      <input type="number" id="timer" />
    </label>

    <button onclick="startHeater()">Start</button>
    <button onclick="stopHeater()">Stop</button>
  </div>

  <script>
    async function fetchSensorData() {
      const res = await fetch('/api/sensor-data');
      const data = await res.json();
      document.getElementById('temp').textContent = data.temp;
      document.getElementById('humidity').textContent = data.humidity;
      document.getElementById('current').textContent = data.current;
      document.getElementById('relay').textContent = data.relay ? 'ON' : 'OFF';
    }

    async function startHeater() {
      const maxTemp = parseFloat(document.getElementById('maxTemp').value);
      const timer = parseInt(document.getElementById('timer').value);

      await fetch('/api/control', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ start: true, maxTemp, timerSeconds: timer })
      });
    }

    async function stopHeater() {
      await fetch('/api/control', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ start: false })
      });
    }

    setInterval(fetchSensorData, 1000);
  </script>
</body>
</html>
